<%- include("../layout", {
    body: `
<h2>Admin Ticket View (Insecure)</h2>

<p><strong>ID:</strong> ${ticket.id}</p>
<p><strong>Title:</strong> ${ticket.title}</p>
<p><strong>User:</strong> ${ticket.owner_username}</p>
<p><strong>Status:</strong> ${ticket.status}</p>
<p><strong>Category:</strong> ${ticket.category}</p>
<p><strong>Created:</strong> ${ticket.created_at}</p>

<h3>Description</h3>
<div style="border:1px solid #ccc; padding:10px;">
    ${ticket.description}
</div>

<hr>

<h3>Update Status (Insecure)</h3>
<form method="POST" action="/admin/tickets/${ticket.id}/status">
    <select name="status">
        <option>Open</option>
        <option>In Progress</option>
        <option>Waiting on User</option>
        <option>Resolved</option>
    </select>
    <button type="submit">Update</button>
</form>

<hr>

<h3>Admin Comments (Insecure - Stored XSS)</h3>

${comments.map(c => `
    <div style="border:1px solid #aaa; padding:10px; margin-bottom:10px;">
        <strong>${c.admin_username}:</strong><br>
        ${c.comment}
        <br><small>${c.created_at}</small>
    </div>
`).join('')}

<h4>Add Comment (Insecure)</h4>
<form method="POST" action="/admin/tickets/${ticket.id}/comments">
    <textarea name="comment" rows="4" cols="50"></textarea><br>
    <button type="submit">Add Comment</button>
</form>

<br>
<a href="/admin">Back to Admin Dashboard</a>
`,
    error: null,
    currentUser: currentUser
}) %>
