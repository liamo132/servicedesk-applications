<%- include("../layout", {
    body: `
<h2>Ticket Details</h2>

<p><strong>ID:</strong> ${ticket.id}</p>
<p><strong>Title:</strong> ${ticket.title}</p>
<p><strong>User:</strong> ${ticket.owner_username}</p>
<p><strong>Status:</strong> ${ticket.status}</p>
<p><strong>Category:</strong> ${ticket.category}</p>
<p><strong>Created:</strong> ${ticket.created_at}</p>

<h3>Description</h3>
<div style="border:1px solid #ccc; padding:10px; background:#fff;">
    ${ticket.description}
</div>

<hr>

<h3>Update Status</h3>
<form method="POST" action="/admin/tickets/${ticket.id}/status">
    <input type="hidden" name="_csrf" value="${csrfToken}">
    <select name="status">
        <option value="Open">Open</option>
        <option value="In Progress">In Progress</option>
        <option value="Waiting on User">Waiting on User</option>
        <option value="Resolved">Resolved</option>
    </select>
    <button type="submit">Update</button>
</form>

<hr>

<h3>User Comments</h3>
`,
    error: error,
    currentUser: currentUser
}) %>

<% if (userComments.length === 0) { %>
    <p>No user comments yet.</p>
<% } else { %>
    <% userComments.forEach(c => { %>
        <div style="border:1px solid #aaa; padding:10px; margin-bottom:10px;">
            <strong><%= c.commenter %>:</strong><br>
            <div><%= c.comment %></div>
            <small><%= c.created_at %></small>
        </div>
    <% }) %>
<% } %>

<hr>

<h3>Admin Comments</h3>

<% if (adminComments.length === 0) { %>
    <p>No admin comments yet.</p>
<% } else { %>
    <% adminComments.forEach(c => { %>
        <div style="border:1px solid #aaa; margin-bottom:10px; padding:10px;">
            <strong><%= c.admin_username %>:</strong><br>
            <div><%= c.comment %></div>
            <small><%= c.created_at %></small>
        </div>
    <% }) %>
<% } %>

<h4>Add Admin Comment</h4>

<form method="POST" action="/admin/tickets/<%= ticket.id %>/comments">
    <input type="hidden" name="_csrf" value="<%= csrfToken %>">
    <textarea name="comment" rows="4" cols="50" required></textarea>
    <br>
    <button type="submit">Add Comment</button>
</form>

<br>
<a href="/admin">Back to Admin Panel</a>
